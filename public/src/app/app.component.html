
<nav class="navbar navbar-dark bg-dark shadow navbar-sm">
    <div class="container-fluid">
        <div class="navbar-header">
          <span class="navbar-brand">
            {{title}}
          </span>
          <span class="navbar-phase">
            <a target='_blank' href='https://github.com/keymanapp/keyman/issues?utf8=%E2%9C%93&q=is%3Aopen+is%3Aissue+milestone%3A{{phase?.node.title}}+org%3Akeymanapp'>{{phase?.node.title}}</a>
            <span class="navbar-phase-dates">{{phaseStart}} &mdash; {{phaseEnd}}</span>
          </span>
          <span class="navbar-new-issues">
            <a target='_blank' href="https://github.com/keymanapp/keyman/issues?q=is%3Aopen+is%3Aissue+no%3Amilestone" class="label hide-if-zero {{errorClassIfNonZero(status?.github.data.repository.issuesWithNoMilestone.totalCount)}}">New issues: {{status?.github.data.repository.issuesWithNoMilestone.totalCount}}</a>
          </span>
          <span class="navbar-new-pulls">
            <span *ngFor="let pull of unlabeledPulls">
              <app-pull-request [class]="'failure'" [pull]="pull"></app-pull-request>
              <!--
                <a href="{{pull.pull.node.url}}" class="label {{pullClass(pull)}}" title="{{pull.pull.node.title}}: {{pull.state?.description}}" target="_blank">{{pull.pull.node.number}}</a>
              -->
            </span>
          </span>
          <span class="navbar-contributions" *ngIf="showContributions">
            <span class="navbar-contribution" *ngFor="let user of status?.contributions.data.repository.contributions.nodes">
              <span *ngIf="user.contributions.pullRequests.nodes.length + user.contributions.reviews.nodes.length + user.contributions.issues.nodes.length > 0">
                <img class="avatar-40" src="{{user.avatarUrl}}&size=40">
                <span class="navbar-contribution-data dropdown-menu-right">
                  <table class="table table-striped table-bordered">
                    <thead>
                      <tr>
                        <th style='width:9%'>
                          <a href='https://github.com/{{user.login}}?tab=overview&from={{sprintDays[0].ghdate}}&to={{sprintDays[13].ghdate}}' target='_blank'><img class="avatar-48" src="{{user.avatarUrl}}&size=48">
                          {{user.login}}</a>
                        </th>
                        <th style='width:6.5%' *ngFor="let day of sprintDays">
                          <a href='https://github.com/{{user.login}}?tab=overview&from={{day.ghdate}}&to={{day.ghdate}}' target='_blank'>{{day.dayText}}<br>{{day.monthText}} {{day.dateText}}</a>
                        </th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <th>Issues</th>
                        <td  *ngFor="let day of sprintDays">
                          <span *ngFor="let issue of user.contributions.issues.nodes | filterObjectByDate: day.date">
                            <a class='contribution-issue' href='{{issue.issue.url}}' target='_blank' title='{{issue.issue.title}}'>{{issue.issue.number}}</a>
                          </span>
                        </td>
                      </tr>
                      <tr>
                        <th>PRs</th>
                        <td *ngFor="let day of sprintDays">
                          <span *ngFor="let pr of user.contributions.pullRequests.nodes | filterObjectByDate: day.date">
                            <a class='contribution-issue' href='{{pr.pullRequest.url}}' target='_blank' title='{{pr.pullRequest.title}}'>{{pr.pullRequest.number}}</a>
                          </span>
                        </td>
                      </tr>
                      <tr>
                        <th>Reviews</th>
                        <td *ngFor="let day of sprintDays">
                          <span *ngFor="let review of user.contributions.reviews.nodes | filterObjectByDate: day.date">
                            <a class='contribution-issue' href='{{review.pullRequest.url}}' target='_blank' title='{{review.pullRequest.title}}'>{{review.pullRequest.number}}</a>
                          </span>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </span>
              </span>
            </span>
          </span>
        </div>
    </div>
</nav>

<!-- <h1></h1> -->

<div class="container-fluid {{isBetaRunning() ? 'in-beta' : 'not-in-beta'}}">
  <table class="table table-striped table-bordered">
    <thead class='thead-dark'>
      <tr>
        <th id='th-platform'>Platform</th>
        <th id='th-stable' class='tier'>Stable</th>
        <th id='th-beta' class='tier'>Beta</th>
        <th id='th-alpha' class='tier'>Alpha</th>
        <th id='th-issues'>Issues</th>
        <!--<th id='th-crashes'>Crashes</th>-->
        <th id='th-pulls'>Pull Requests</th>
      </tr>
    </thead>
    <tbody>
      <tr class='tr-platform' *ngFor="let platform of platforms | keyvalue">
        <th><img src="assets/{{platform.key}}.png">&#160;&#160;<a href="https://github.com/keymanapp/keyman/pulls?q=is%3Aopen+is%3Apr+label%3A{{platform.key}}" target="_blank">{{platform.value.name}}</a></th>

        <td class="tier" id="tier-stable">
          <div class="tier-container">
            <div class="tier-release">
              <div class="tier-release-date">
                {{releaseDate(platform.key,'stable')}}
              </div>
              <div class="tier-release-version">
                {{status?.keyman[platform.key].stable.version}}
              </div>
            </div>
            <div class="tier-build-state" title="{{statusTip(platform.key,'stable')}}">
              <a class="label {{statusClass(platform.key,'stable')}}" href="{{statusLink(platform.key,'stable')}}" target="_blank">{{statusText(platform.key,'stable')}}</a>
            </div>
          </div>
        </td>

        <td class="tier" id="tier-beta">
          <div class="tier-container">
            <div class="tier-release">
              <div class="tier-release-date">
                {{releaseDate(platform.key,'beta')}}
              </div>
              <div class="tier-release-version">
                {{status?.keyman[platform.key].beta.version}}
              </div>
            </div>
            <div class="tier-build-state" title="{{statusTip(platform.key,'beta')}}">
              <a class="label {{statusClass(platform.key,'beta')}}" href="{{statusLink(platform.key,'beta')}}" target="_blank">{{statusText(platform.key,'beta')}}</a>
            </div>
          </div>
        </td>

        <td class="tier" id="tier-alpha">
          <div class="tier-container">
            <div class="tier-release">
              <div class="tier-release-date">
                {{releaseDate(platform.key,'alpha')}}
              </div>
              <div class="tier-release-version">
                {{status?.keyman[platform.key].alpha.version}}
              </div>
            </div>
            <div class="tier-build-state" title="{{statusTip(platform.key,'alpha')}}">
              <a class="label {{statusClass(platform.key,'alpha')}}" href="{{statusLink(platform.key,'alpha')}}" target="_blank">{{statusText(platform.key,'alpha')}}</a>
            </div>
          </div>
        </td>

        <td class="issues">
          <ng-container *ngFor="let milestone of platform.value.milestones">
            <a target='_blank' href='https://github.com/keymanapp/keyman/issues?utf8=%E2%9C%93&q=is%3Aopen+is%3Aissue+label%3A{{platform.key}}+{{milestone.title=="Other" ? "no:milestone" : "milestone:"+milestone.title}}'>
              <span class='countbox milestone-{{milestone.id}}' *ngIf="milestone.count > 0">
                <span class='countbox-title'>{{milestone.title}}</span>
                <span class='countbox-value'>{{milestone.count}}</span>
              </span>
            </a>
          </ng-container>
        </td>
        <!--<td class="crashes"></td>-->

        <td class="pulls">
          <span *ngFor="let pull of platform.value.pulls">
            <app-pull-request [pull]="pull"></app-pull-request>
          </span>
        </td>
      </tr>
    </tbody>
  </table>
  <table class="table table-striped table-bordered">
    <tbody>
      <tr class='tr-site'>
        <!--<th rowspan='2' id='th-sites'><a href='https://sitestatus.keyman.com/' target='_blank'>Websites</a></th>-->
        <th x-colspan='3' *ngFor="let site of sites | keyvalue"><a target="_blank" href='https://{{site.key}}'>{{site.value.id}}</a> <span class='nodeping'></span></th>
      </tr>
      <tr class='tr-site'>
        <ng-container *ngFor="let site of sites | keyvalue">
        <!--<td class='issues'></td>
        <td class='crashes'></td>-->
        <td class='pulls'>
          <span *ngFor="let pull of site.value.pulls">
            <!-- TODO: use Pull Request component -->
            <app-pull-request [class]="'missing'" [pull]="pull"></app-pull-request>
            <!--<a href="{{pull.pull.url}}" class="label " title="{{pull.pull.title}}" target="_blank">{{pull.pull.number}}</a>-->
          </span>
        </td>
        </ng-container>
      </tr>
      <tr class='tr-site'>
        <ng-container *ngFor="let site of sites | keyvalue">
          <!--<td class='issues'></td>
          <td class='crashes'></td>-->
          <td class='issues'>

            <ng-container *ngFor="let milestone of site.value.milestones">
              <a target='_blank' href='https://github.com/keymanapp/{{site.key}}/issues?utf8=%E2%9C%93&q=is%3Aopen+is%3Aissue+{{milestone.title=="Other" ? "no:milestone" : "milestone:"+milestone.title}}'>
                <span class='countbox milestone-{{milestone.id}}' *ngIf="milestone.count > 0 && site.key != 'developer.keyman.com'">
                  <span class='countbox-title'>{{milestone.title}}</span>
                  <span class='countbox-value'>{{milestone.count}}</span>
                </span>

                <!-- Because Eberhard is not following our sprint schedule, all his issues appear in red. Work around this for now so we don't get unduly worrit -->
                <span class='countbox milestone-future' *ngIf="milestone.count > 0 && site.key == 'developer.keyman.com'">
                  <span class='countbox-title'>{{milestone.title}}</span>
                  <span class='countbox-value'>{{milestone.count}}</span>
                </span>

              </a>
            </ng-container>
          </td>
        </ng-container>
      </tr>
    </tbody>
  </table>


</div>